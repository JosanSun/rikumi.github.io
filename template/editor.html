<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>RIKU の 部屋丨{{ filename }}</title>
    <style> html, body { margin: 0; padding: 0; background: #1d1f21; color: #1d1f21; } </style>
</head>
<body>
<button id="btn" onclick="save()" style="display: block; width: 100%; height: 40px; border: 0; background: #1d1f21; color: #ccc; font-size: 15px">RIKU の 部屋丨点击同步</button>
<div style="display: block; font-size: 14px; line-height: 24px; font-family: Menlo, 'Ubuntu Mono', Consolas, 'Courier New', 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif; position: absolute; top: 40px; left: 0px; right: 0px; bottom: 0px;"
     id="editor">{{ content }}</div>
<script src="static/js/keymaster.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/theme-tomorrow-night.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/mode-markdown.js" type="text/javascript" charset="utf-8"></script>
<script src="http://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script>
<script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/tomorrow_night");
        var MarkdownMode = ace.require("ace/mode/markdown").Mode;
        editor.session.setMode(new MarkdownMode());
        editor.session.setUseWrapMode("free");
        window.document.title = "RIKU の 部屋丨{{ filename }}丨分支 {{ branch }}";

        var lastSave = editor.getValue();
        setInterval(function() {
            if (editor.getValue() != lastSave) {
                changed = true;
                $("#btn").html('保存并同步');
            }
        }, 1000);

        var changed = false;
        function save() {
            $.ajax({ type: 'POST', url: window.location.href, data: changed ? {
                data: editor.getValue(),
                branch: "{{ branch }}"
            } : {}, success: function (content) {
                lastSave = content;
                editor.setValue(content);
                $("#btn").html('同步成功');
                setTimeout(function() {
                    $("#btn").html('RIKU の 部屋丨点击同步');
                }, 1000);
                changed = false;
            }});
        }
</script>
</body>
</html>
